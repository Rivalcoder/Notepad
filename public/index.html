<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Notes App</title>
    <link rel="stylesheet" href="/style">
</head>
<body>
    <h1>My Notes App</h1>

    <!-- Modal for username input -->
    <div class="modal" id="usernameModal">
        <div class="modal-content" id="modal-content">
            <center>
                <form onsubmit="submitUsername(); return false;">
                    <h2>Enter Your Username</h2>
                    <input class="a" type="text" id="username" placeholder="Username" required><br>
                    <button class="b" type="submit">Submit</button>
                </form>
            </center>
        </div>
    </div>

    <div id="notesSection" style="display: none;">
        <center>
            <h2>Notes for <span id="currentUsername"></span></h2>
            <textarea id="noteText" class="area" placeholder="Enter your notes here"></textarea>
            <br>
            <button id="addNoteButton" type="button" onclick="addNote()">Add Note</button>
            <button id="showNotesButton" type="button" onclick="showNotes()">Show Notes</button>
        </center>
        <br>
        <ul id="taskList"></ul> <!-- Change to unordered list for notes -->
        <div id="responseMessage" style="text-align: center; margin-top: 20px;"></div>
    </div>

    <script>
        function submitUsername() {
            const modal = document.getElementById("usernameModal");
            modal.style.display = "none"; // Hide modal after submitting username

            const username = document.getElementById('username').value;
            document.getElementById('currentUsername').textContent = username;

            // Fetch notes after entering the username
            fetchNotes(username);

            // Show notes section
            document.getElementById('notesSection').style.display = 'block';
        }

        function addNote() {
            const username = document.getElementById('currentUsername').textContent;
            const note = document.getElementById('noteText').value.trim();

            if (note === "") {
                alert("Please enter a valid note!");
                return;
            }

            fetch(`/addNote?username=${encodeURIComponent(username)}&note=${encodeURIComponent(note)}`)
                .then(response => response.json())
                .then(result => {
                    document.getElementById('responseMessage').textContent = result.message;
                    document.getElementById('noteText').value = ''; // Clear textarea
                    fetchNotes(username); // Refresh notes list
                })
                .catch(error => {
                    console.error("Error adding note:", error);
                    document.getElementById('responseMessage').textContent = "Failed to add note. Please try again.";
                });
        }

        function showNotes() {
            const username = document.getElementById('currentUsername').textContent;
            fetchNotes(username);
        }

        function fetchNotes(username) {
            fetch(`/notes?username=${encodeURIComponent(username)}`)
                .then(response => response.json())
                .then(notes => {
                    const taskList = document.getElementById('taskList');
                    taskList.innerHTML = ''; // Clear existing notes

                    if (notes.length === 0) {
                        taskList.style.display = "none"; // Hide list if empty
                    } else {
                        taskList.style.display = "block"; // Show list if not empty
                        notes.forEach(note => {
                            const listItem = document.createElement('li');
                            listItem.textContent = note; // Show the note content

                            // Create delete button
                            const deleteButton = document.createElement('button');
                            deleteButton.className = 'delete-button';
                            deleteButton.textContent = '❌'; // Use a simple delete icon
                            deleteButton.onclick = () => {
                                deleteNote(username, note);
                            };

                            // Append the delete button to the list item
                            listItem.appendChild(deleteButton);
                            taskList.appendChild(listItem);
                        });
                    }
                })
                .catch(error => {
                    console.error("Error fetching notes:", error);
                    document.getElementById('responseMessage').textContent = "Failed to load notes. Please try again.";
                });
        }

        function deleteNote(username, note) {
            fetch(`/deleteNote?username=${encodeURIComponent(username)}&note=${encodeURIComponent(note)}`)
                .then(response => response.json())
                .then(result => {
                    document.getElementById('responseMessage').textContent = result.message;
                    fetchNotes(username); // Refresh notes list
                })
                .catch(error => {
                    console.error("Error deleting note:", error);
                    document.getElementById('responseMessage').textContent = "Failed to delete note. Please try again.";
                });
        }
    </script>
</body>
</html>
